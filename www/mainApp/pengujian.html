<div class='container'>
  <div class='margin-bottom:12px;'>
    <h4>
      Pengujian Greddy
    </h4>
  </div>
  <div class="input-field col s12"  style='margin-top:20px;'>
    <select id='txtKlinik1'>
       <option value="1">Klinik Marinda</option>
      <option value="2">Klinik Pratama</option>
      <option value="3">Klinik Rizal</option>
    </select>
    <label>Lokasi Awal</label>
  </div>

 <div class="input-field col s12" style='padding-top:20px;'>
    <select  id='txtKlinik2'>
      <option value="" disabled selected>Pilih klinik</option>
      <option value="1">Klinik Marinda</option>
      <option value="2">Klinik Pratama</option>
      <option value="3">Klinik Rizal</option>
    </select>
    <label>Lokasi Tujuan</label>
  </div>

<button class='btn'>Hitung</button>

<div id="container"></div>
</div> 

<script type='text/javascript'>
  
  $(document).ready(function(){
    $('select').material_select();
  
     var width = window.innerWidth - 20;
      var height = window.innerHeight - 20;

      var stage = new Konva.Stage({
        container: 'container',
        width: width,
        height: height
      });

      var layer = new Konva.Layer();
      stage.add(layer);
    
    $.get('http://157.245.154.248:3565/klinik/all',function(data){
   
      let panjang = data.length;
      console.log(data[1].kordinat_x);
      
      // function to generate a list of "targets" (circles)
      function generateTargets() {
        var number = panjang;
        var result = [];
        let nA = 0;
        while (result.length < panjang) {
          let xc = data[nA].kordinat_x;
          let yc = data[nA].kordinat_y;
          console.log(xc);
          result.push({
            id: 'target-' + result.length,
            x: stage.width() * xc,
            y: stage.height() * yc
          });
          console.log(Math.random());
          nA++;
        }
        return result;
      }

      var targets = generateTargets();

      // function to generate arrows between targets
      function generateConnectors() {
        var number = panjang;
        var result = [];
        while (result.length < number) {
          var from = 'target-' + Math.floor(Math.random() * targets.length);
          var to = 'target-' + Math.floor(Math.random() * targets.length);
          if (from === to) {
            continue;
          }
          result.push({
            id: 'connector-' + result.length,
            from: from,
            to: to
          });
        }
        return result;
      }

      function getConnectorPoints(from, to) {
        const dx = to.x - from.x;
        const dy = to.y - from.y;
        let angle = Math.atan2(-dy, dx);

        const radius = 50;

        return [
          from.x + -radius * Math.cos(angle + Math.PI),
          from.y + radius * Math.sin(angle + Math.PI),
          to.x + -radius * Math.cos(angle),
          to.y + radius * Math.sin(angle)
        ];
      }

      var connectors = generateConnectors();

      // update all objects on the canvas from the state of the app
      function updateObjects() {
        targets.forEach(target => {
          var node = layer.findOne('#' + target.id);
          node.x(target.x);
          node.y(target.y);
        });
        connectors.forEach(connect => {
          var line = layer.findOne('#' + connect.id);
          var fromNode = layer.findOne('#' + connect.from);
          var toNode = layer.findOne('#' + connect.to);

          const points = getConnectorPoints(
            fromNode.position(),
            toNode.position()
          );
          line.points(points);
        });
        layer.batchDraw();
      }

      // generate nodes for the app
      connectors.forEach(connect => {
        var line = new Konva.Arrow({
          stroke: 'black',
          id: connect.id,
          fill: 'black'
        });
        layer.add(line);
      });

      targets.forEach(target => {
        var node = new Konva.Circle({
          id: target.id,
          fill: Konva.Util.getRandomColor(),
          radius: 15 + 1 * 15,
          shadowBlur: 10,
          draggable: true
        });
        layer.add(node);

        node.on('dragmove', () => {
          // mutate the state
          target.x = node.x();
          target.y = node.y();

          // update nodes from the new state
          updateObjects();
        });
      });

      updateObjects();
      
    });
    
    

      
    
    
  });
     
    </script>